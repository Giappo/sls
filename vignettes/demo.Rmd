---
title: "Single Lineage Shift"
author: "Giovanni Laudanno"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
This package can calculate the likelihood for phylogenies with any number of single-lineage rate shifts.
```{r}
rm(list = ls()); library(sls)
```

You can load the data with:
```{r}
load_all_data(the.environment = environment()); data.sets <- ls(pattern = "dataset_",envir = environment())
ls()
```

We can read the dataset:
```{r}
get("dataset_2")
```
Here times_matrix contains information about time points and topology of the tree:
- the first line contains the time points;
- the second line contains information about which lineage (the absolute value of the number) is undergoing which event (its sign: positive is a branching event, negative is a shift). 
Lambdas and mus are the value of the rates for each regime.

Then you can use one of the preloaded datasets to calculate its likelihood:
```{r}
lik_custom_split2(dataset = dataset_pure_shifting3)
```

It is possible to test the result with simulations, if they're number is high enough.
```{r}
sim_custom_repeat(dataset = dataset_pure_shifting3, Nsims = 1E4)$sim_result
```

Both functions are wrapped into a single function that makes the comparison easier, providing also an error bar to compare results.
```{r}
test_result <- test_likelihood_formula(dataset = dataset_pure_shifting3, Nsims = 1E4, 
                                        lik_function = lik_custom_split2, sim_function = sim_custom)
print(test_result$results.table)
```
